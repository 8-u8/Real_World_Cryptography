<!--title: chp02 -->
# 2章 ハッシュ関数
- ハッシュ関数とセキュリティ特性
- 現在使われるハッシュ関数
- ハッシュの仕組み

「どんなものにも、全体の中で重複しない識別情報を結びつける」ことがハッシュ関数の仕事。
任意の文字列から特定のバイト列を生成する。
入力が同じなら、同じハッシュ列を返す。これが強い。

# 2.1 ハッシュ関数とは何か

アプリのダウンロードとか、パッケージのインストールなどで謎の文字列が生まれる。

たとえば `sha256sum`とか見たことありそう。これはどのように処理・生成されるのだろうか。

【プロトコル】

- ボタンをクリックしてファイルをダウンロードする
- ダウンロードしたファイルを SHA-256 アルゴリズムでハッシュする
- ハッシュした出力(=ダイジェスト/ハッシュ)を、ウェブページに表示されている文字列と比較する。
    - これが合っている=同じハッシュ値=入力(DLしたファイル)が同じ。

実際にSHA-256を `openssl`でやってみると確かに一致する。
これをやる目的: ダウンロードしたものが、ダウンロードしようと意図していたファイルに違いないという保証をしたい。

- 完全性(integrity)
- 真正性(authenticity)

ハッシュ関数には「第二現像困難性」がある。

→ ハッシュ値がおなじになるような「別のファイル」を見つけることは難しい。

ハッシュ値…ウェブページの所有者が管理していて、ウェブページを書き換えられる人なら、誰でも簡単に差し替えられる点には注意。

→ ダイジェストを提供しているページ、所有者、ページ取得に使われる仕組み
　を信頼する必要がある。

→ 書き換えられる状態だとハッシュ関数だけでは完全性を保証出来ない。

ダウンロードされるファイルの完全性は、ダイジェストと、ダイジェストを提供する仕組み(httpsなど)

ハッシュ関数の入力: 何でもいい。空白ですらいい。
ハッシュ関数の出力: 決定論的に「同じ長さ」になる(SHA-256は256ビット)

→ 16進数の数字列64個で表現される。

一文字かわるだけで全部違う。

# 2.2 ハッシュ関数のセキュリティ特性

- 現像計算困難性
    - ある出力が与えられるとき、ハッシュ関数を逆に計算して入力を求めることはできない
    - ミキサーみたいなもん。一回キャベツぶっこんだら終わり。
    
    > 入力が小さい場合、たとえば入力が3文字しかない場合は総当たりで試せちゃう。
    また、入力の差が小さい場合。「月曜日の午前3時に帰宅する」について、たとえば
    「月曜の15時に帰宅する」とか「月曜午後3時に帰宅する」など、色々試せるとすると、
    正確な入力が得られるかもしれない。
    > 
    
    正直現像計算困難性は完全に達成することは難しい
    
- 第二現像計算困難性
    - ある入力とダイジェストがあるとき、ハッシュして同じダイジェストになるような
    「別の入力」を求めることが出来ない。
    - 現像計算困難性を補う特性。
    - 最初の入力は何もコントロールしていない。
        - 攻撃者はファイル管理者の持つダイジェストと同じハッシュ値を持つファイルに
        悪意を仕込んで差し替えるような動きが想定できる
- 衝突困難性（衝突計算困難性/衝突耐性）
    - ハッシュして同じ値になるような2種類の入力は存在しない
    - 衝突困難性では、攻撃者が入力をコントロールする。
    つまり、同じハッシュ値を持つ2つのファイルを用意して、
    一方に善意、もう一方で悪意を仕込んで、悪意をDLさせる動きができる
    
    > 衝突困難性と第二現像計算困難性の違いは何だろう？
    → 攻撃者が2つの入力を選ぶことができる点。
    > 

ランダムオラクル

ハッシュ関数は一般的に、予測不能でランダムなダイジェストを出力するように設計される。
ハッシュ関数のセキュリティ特性上、プロトコルが安全であると永続的に保証できないので、
ランダムで予測不能に設計する必要がある。
「ランダムオラクル」は架空の構造を想定したモデル。プロトコルはこれを使って安全性を保証する。
ランダムオラクルを使うプロトコルでは、任意の入力を送信して、全くランダムな出力が返される。

# 2.3

# 2.4

## 2.4.1

## 2.4.2

## 2.4.3

## 2.4.4

# 2.5

## 2.5.1

## 2.5.2

## 2.5.3

## 2.5.4

# 2.6